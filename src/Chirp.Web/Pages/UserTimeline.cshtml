@page "/{author}"
@model Chirp.Razor.Pages.UserTimelineModel
@{
    ViewData["Title"] = "Chirp!";
    Layout = "Shared/_Layout";
    var routeName = HttpContext.GetRouteValue("author");
}

<div>
    <h2>@routeName's Timeline</h2>

    @if (Model.Cheeps.Any()) // Display cheeps for the specified author
    {
        <ul id="messagelist" class="cheeps">
            @foreach (var cheep in Model.Cheeps)
            {
                <li>
                            <div class="profile-picture-container">
                            @if (cheep.User.ProfilePicture != null)
                            {
                                <img src="data:image/png;base64,@Convert.ToBase64String(cheep.User.ProfilePicture)" alt="Profile Picture" class="profile-picture" />
                            }
                            else
                            {
                                <img src="/images/default-profile.png" alt="Default Profile Picture" class="profile-picture" />
                            }
                            </div>
                    <p>
                        <strong>
                            <a href="/@cheep.User.UserName">@cheep.User.UserName</a>
                        </strong>
                        @cheep.Text
                    </p>
                    <p>@cheep.TimeStamp</p>
                </li>
            }
        </ul>
    }
    else
    {
        <p>No cheeps found for this user.</p>
    }

    @if (Model.CurrentUser != null && string.Equals(Model.CurrentUser.UserName, routeName as string, StringComparison.Ordinal))
    {
        <h3>Cheeps from Followed Users</h3>
        @if (Model.CheepsFromFollowings.Any())
        {
            <ul id="followedCheeps" class="cheeps">
                @foreach (var cheep in Model.CheepsFromFollowings)
                {
                    <li>
                            <div class="profile-picture-container">
                            @if (cheep.User.ProfilePicture != null)
                            {
                                <img src="data:image/png;base64,@Convert.ToBase64String(cheep.User.ProfilePicture)" alt="Profile Picture" class="profile-picture" />
                            }
                            else
                            {
                                <img src="/images/default-profile.png" alt="Default Profile Picture" class="profile-picture" />
                            }
                            </div>
                        <p>
                            <strong>
                                <a href="/@cheep.User.UserName">@cheep.User.UserName</a>
                            </strong>
                            @cheep.Text
                        </p>
                        <p>
                            <form method="post" asp-page-handler="Unfollow">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="unfolloweeId" value="@cheep.User.Id" />
                                <button type="submit" style="float:right;" class="btn btn-outline-secondary btn-sm">Unfollow</button>
                            </form>
                        </p>
                        <p>@cheep.TimeStamp</p>
                    </li>
                }
            </ul>
        }
        else
        {
            <p>You are not following anyone yet.</p>
        }
    }